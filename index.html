<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Discernment Flow Chart</title>
<style>
  body { font-family: Arial, sans-serif; background: #f7f7f7; margin:0; padding:0; }
  .container { max-width: 650px; margin:auto; padding:20px; }
  .top-bar { display:flex; justify-content:space-between; margin-bottom:10px; }
  .card {
    background:#fff; padding:20px; border-radius:8px;
    box-shadow:0 2px 6px rgba(0,0,0,0.1); min-height:260px;
    display:flex; flex-direction:column; justify-content:space-between;
  }
  .segment-heading {
    font-size:1.4em; font-weight:bold; margin-bottom:15px; padding:8px;
    border-bottom:2px solid #ddd; display:flex; align-items:center; gap:8px;
    transition: background-color .5s ease, color .5s ease;
  }
  .flash-gold { background-color:gold !important; color:#fff !important; }
  .text { font-size:1.2em; margin-bottom:12px; white-space:pre-wrap; }
  .viz-toggle { margin:8px 0 16px 0; }
  .viz-panel { display:none; border:1px solid #eee; border-radius:6px; padding:10px; background:#fafafa; }
  .viz-panel img { width:100%; height:auto; display:block; }
  .buttons { display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-start; }
  .buttons.center { justify-content:center; }
  button { flex:1; padding:10px; font-size:1em; border:none; border-radius:5px; cursor:pointer; }
  button.yes { background:#4CAF50; color:#fff; }
  button.no { background:#F44336; color:#fff; }
  button.next { background:#2196F3; color:#fff; }
  button.back { background:#9E9E9E; color:#fff; flex:0 0 auto; }
  button.restart { background:#9C27B0; color:#fff; flex:0 0 auto; }
  button.viz-btn { background:#555; color:#fff; flex:0 0 auto; }
  .error { color:#B00020; font-size:0.95em; margin-top:8px; }
</style>
</head>
<body>
<div class="container">
  <div class="top-bar">
    <button class="back" id="backBtn" onclick="goBack()">Back</button>
    <button class="restart" id="restartTop" onclick="restart()">Restart</button>
  </div>

  <div class="card">
    <div id="segmentHeading" class="segment-heading"></div>

    <div>
      <div id="text" class="text"></div>

      <!-- Visualization UI (appears only on Q15 / Q17) -->
      <div id="vizToggleWrapper" class="viz-toggle"></div>
      <div id="vizPanel" class="viz-panel">
        <img id="vizImage" alt="Visualization">
      </div>

      <div id="errorBox" class="error"></div>
    </div>

    <div id="buttons" class="buttons"></div>
  </div>
</div>

<script>
// ======= CLEAN, SEQUENTIALLY NUMBERED JSON (Q1–Q34) =======
// Types: "question" (yes/no), "info" (Next only), "result" (endpoint)
const flowchart = [
  { "id": "Q1",  "type": "question", "text": "Are there any other more important things to do or think about right now?", "yes": "R1", "no": "Q2" },
  { "id": "Q2",  "type": "question", "text": "Is there a known problem or potential QoL change that involves your needs and wants of a subject not being met functionally?", "yes": "Q5", "no": "Q3" },
  { "id": "Q3",  "type": "question", "text": "Is there cause for a potential problem that would directly affect your needs and wants of a subject not being met functionally?", "yes": "Q5", "no": "Q4" },
  { "id": "Q4",  "type": "question", "text": "Is there cause for a POTENTIAL cause for a POTENTIAL problem that would directly affect your needs and wants of a subject not being met functionally?", "yes": "Q5", "no": "R2" },
  { "id": "Q5",  "type": "question", "text": "Is there a solution to the problem/potential problem even if it’s currently unavailable (or a means of bringing about the QoL change)?", "yes": "Q6", "no": "R3" },
  { "id": "Q6",  "type": "question", "text": "Can this solution or QoL change be brought about by your influence?", "yes": "Q9", "no": "Q7" },
  { "id": "Q7",  "type": "question", "text": "Do everything in your power first to achieve the desired result, but know that past that it’s out of your hands, and worrying and obsessing won’t change anything and is unhealthy. Is there anything further you can do?", "yes": "Q9", "no": "Q8" },
  { "id": "Q8",  "type": "question", "text": "Is there an alternative solution that would solve the problem (or improve QoL) in a way that’s within your control or in a better overall way?", "yes": "R4", "no": "R2" },
  { "id": "Q9",  "type": "question", "text": "Does this solution or QoL change involve gaining information that would be valuable in the future?", "yes": "Q10", "no": "Q11" },
  { "id": "Q10", "type": "question", "text": "Would the information alone gained from doing this outweigh the downsides it would likely cause to make this happen?", "yes": "Q24", "no": "Q11" },
  { "id": "Q11", "type": "question", "text": "Is it worth your resources to solve it?", "yes": "Q13", "no": "Q12" },
  { "id": "Q12", "type": "question", "text": "Is there an alternative solution that would solve the problem (or improve QoL) in a way that’s worth it to you or in a better overall way?", "yes": "R4", "no": "R2" },
  { "id": "Q13", "type": "question", "text": "Would the benefits of addressing this issue outweigh any downsides it might likely cause?", "yes": "Q15", "no": "Q14" },
  { "id": "Q14", "type": "question", "text": "Is there an alternative solution that would solve the problem (or improve QoL) in a way that’s worth it to you or in a better overall way?", "yes": "R4", "no": "R2" },
  { "id": "Q15", "type": "question", "text": "Does addressing this issue involve a diminishing returns curve for effort applied?", "yes": "Q16", "no": "Q17" },
  { "id": "Q16", "type": "info",     "text": "Do your best to find the point of diminishing returns, then only act until that point. Have the courage to stop there. If you are prone to getting sucked into a particular activity (addressing a problem or QoL change), think of an alternative approach that also solves the problem (or improves QoL) in a different way without the addictive aspect. If a better approach is not available for whatever reason, the original approach can be used only if you pre-allocate a set time limit after which you must stop and do something else before re-evaluating.", "next": "Q17" },
  { "id": "Q17", "type": "question", "text": "Does addressing this issue directly involve an inverted-U curve for specific effort applied with an objective sweet spot where clear information is available to you?", "yes": "Q18", "no": "Q19" },
  { "id": "Q18", "type": "info",     "text": "Wait until there aren’t any other more important things to do, then if it’s worth it to you, find that sweet spot. If not, put in as much effort as you deem worth it.", "next": "Q24" },
  { "id": "Q19", "type": "question", "text": "In practice, would a worthwhile functional difference likely be noticed if the problem/potential problem/QoL change was solved/prevented/changed (for example in a blind test compared side by side, and ignoring any differences irrelevant to the actual functionality of the intended purpose associated)?", "yes": "Q20", "no": "R2" },
  { "id": "Q20", "type": "question", "text": "Would solving/preventing it help get rid of/prevent the problem (or improve QoL) in the long term?", "yes": "Q24", "no": "Q21" },
  { "id": "Q21", "type": "question", "text": "Would solving/preventing it help get rid of/prevent the problem (or improve QoL) in the short term?", "yes": "Q22", "no": "R2" },
  { "id": "Q22", "type": "question", "text": "Is it logically worth solving/preventing EVERY time? (Or this time knowing it’s temporary?)", "yes": "Q24", "no": "Q23" },
  { "id": "Q23", "type": "question", "text": "Is there an alternative solution that would solve the problem (or improve QoL), in the long term or in a better overall way?", "yes": "R4", "no": "R2" },

  /* ===== WHEN YOU SHOULD ACT (begins here) ===== */
  { "id": "Q24", "type": "question", "text": "Does this address a current problem or potential QoL change?", "yes": "Q27", "no": "Q25" },
  { "id": "Q25", "type": "question", "text": "Does addressing this issue involve preventative maintenance?", "yes": "Q26", "no": "Q27" },
  { "id": "Q26", "type": "question", "text": "Would there be clear telltale signs of future functional failure before it actually happened, with a big enough window of time to address it properly in advance?", "yes": "R8", "no": "R9" },
  { "id": "Q27", "type": "question", "text": "Is this the best solution you know of assuming you could do it now?", "yes": "Q29", "no": "Q28" },
  { "id": "Q28", "type": "question", "text": "Have you considered all better solutions you know of?", "yes": "Q29", "no": "R4" },
  { "id": "Q29", "type": "question", "text": "Is this solution currently available?", "yes": "Q33", "no": "Q31" },
  { "id": "Q30", "type": "question", "text": "Is there a better time down the road to solve/address this to maximize value?", "yes": "Q31", "no": "R6" },
  { "id": "Q31", "type": "question", "text": "Assuming you waited until it was available, would the benefits of using this solution outweigh the downsides of having to wait?", "yes": "Q34", "no": "Q32" },
  { "id": "Q32", "type": "question", "text": "Is there a next best solution?", "yes": "R4", "no": "R3" },
  { "id": "Q33", "type": "question", "text": "Is there a better time further down the road than when this solution is available to solve/address this to maximize value?", "yes": "R7", "no": "R6" },
  { "id": "Q34", "type": "question", "text": "Is there a better time further down the road than when this solution is available to solve/address this to maximize value?", "yes": "R7", "no": "R5" },

  /* ===== RESULTS ===== */
  { "id": "R1", "type": "result", "text": "Worry about it once the time is right." },
  { "id": "R2", "type": "result", "text": "Don’t worry about it." },
  { "id": "R3", "type": "result", "text": "Wait until there aren’t any other more important things to do, then if it’s worth it to you, find a solution or solutions. If not, put in as much effort as you deem worth it." },
  { "id": "R4", "type": "result", "text": "Consider any other solutions, from best to worst, if you haven’t already. Run them through the chart." },
  { "id": "R5", "type": "result", "text": "Wait until the best solution given the circumstances is available, then solve it once there aren’t any other more important things to do." },
  { "id": "R6", "type": "result", "text": "Address it sooner than later, once there aren’t any other more important things to do." },
  { "id": "R7", "type": "result", "text": "Wait until that time, then solve/address it. Consider any other options that could also work and be worth it until then." },
  { "id": "R8", "type": "result", "text": "Wait until those signs are indicated, the expected downsides of not acting now outweigh the downsides of acting now, AND the estimated chance that current functional failure is nearing or greater than 50%, then solve/address it. Consider any ways to reduce the downsides and/or the likelihood of it failing." },
  { "id": "R9", "type": "result", "text": "Wait until the expected downsides of not acting now outweigh the downsides of acting now, AND the estimated chance that current functional failure is nearing or greater than 50%, then solve/address it. Consider any ways to reduce the downsides and/or the likelihood of it failing." }
];

// ======= APP LOGIC =======
let historyStack = [];
let currentNode = flowchart.find(n => n.id === "Q1");
let currentSegment = "If You Should Act"; // default

// Segment: Q1–Q23 = "If", Q24+ = "When"
function getSegmentForNodeId(id) {
  if (!id || id[0] !== 'Q') return currentSegment; // results keep current segment
  const m = /^Q(\d+)$/.exec(id);
  if (!m) return currentSegment;
  const num = parseInt(m[1], 10);
  return num >= 24 ? "When You Should Act" : "If You Should Act";
}

function flashHeading() {
  const headingDiv = document.getElementById('segmentHeading');
  headingDiv.classList.add('flash-gold');
  setTimeout(() => headingDiv.classList.remove('flash-gold'), 1500);
}

function getSegmentIcon(segment) {
  return segment === "If You Should Act" ? "⚖️" : "⏳";
}

function renderNode(node) {
  const errorBox = document.getElementById('errorBox');
  errorBox.textContent = '';

  if (!node) {
    errorBox.textContent = "Error: Could not render this step (missing node). Check JSON IDs and links.";
    document.getElementById('text').textContent = '';
    document.getElementById('buttons').innerHTML = '';
    document.getElementById('vizToggleWrapper').innerHTML = '';
    document.getElementById('vizPanel').style.display = 'none';
    document.getElementById('backBtn').style.visibility = historyStack.length > 0 ? 'visible' : 'hidden';
    document.getElementById('segmentHeading').textContent = `${getSegmentIcon(currentSegment)} ${currentSegment}`;
    document.getElementById('restartTop').style.display = 'inline-block';
    return;
  }

  // Update segment AFTER navigating into node
  const thisSegment = getSegmentForNodeId(node.id);
  if (thisSegment !== currentSegment) {
    currentSegment = thisSegment;
    flashHeading();
  }
  document.getElementById('segmentHeading').textContent =
    `${getSegmentIcon(currentSegment)} ${currentSegment}`;

  // Text
  document.getElementById('text').textContent = node.text || '';

  // Back visibility
  document.getElementById('backBtn').style.visibility =
    historyStack.length > 0 ? 'visible' : 'hidden';

  // Visualization toggles
  setupVisualization(node);

  // Buttons area
  const btns = document.getElementById('buttons');
  btns.innerHTML = '';

  // Restart placement logic
  const restartTop = document.getElementById('restartTop');
  if (node.type === 'result') {
    restartTop.style.display = 'none';
    btns.classList.add('center');
    const restartCentered = makeButton('Restart', 'restart', () => restart());
    restartCentered.style.flex = '0 0 auto';
    btns.appendChild(restartCentered);
  } else {
    restartTop.style.display = 'inline-block';
    btns.classList.remove('center');

    if (node.type === 'question') {
      btns.appendChild(makeButton('Yes', 'yes', () => goToNode(node.yes)));
      btns.appendChild(makeButton('No', 'no', () => goToNode(node.no)));
    } else if (node.type === 'info') {
      btns.appendChild(makeButton('Next', 'next', () => goToNode(node.next)));
    }
  }
}

function setupVisualization(node) {
  const toggleWrap = document.getElementById('vizToggleWrapper');
  const panel = document.getElementById('vizPanel');
  const img = document.getElementById('vizImage');

  // reset
  toggleWrap.innerHTML = '';
  panel.style.display = 'none';
  img.removeAttribute('src');
  img.removeAttribute('alt');

  // Graphs on Q15 (diminishing returns) and Q17 (inverted-U)
  if (node.id === 'Q15') {
    attachViz(toggleWrap, panel, img, 'diminishing_returns_curve.png',
      'Diminishing Returns Curve: Effort/Resources vs Functional Results');
  } else if (node.id === 'Q17') {
    attachViz(toggleWrap, panel, img, 'inverted_u_curve.png',
      'Inverted-U Curve: Effort/Resources vs Functional Results');
  }
}

function attachViz(toggleWrap, panel, img, src, alt) {
  const btn = document.createElement('button');
  btn.textContent = 'Show visualization';
  btn.className = 'viz-btn';
  btn.setAttribute('aria-expanded', 'false');

  btn.onclick = () => {
    const isOpen = panel.style.display === 'block';
    if (isOpen) {
      panel.style.display = 'none';
      btn.textContent = 'Show visualization';
      btn.setAttribute('aria-expanded', 'false');
    } else {
      if (!img.getAttribute('src')) {
        img.src = src;
        img.alt = alt;
      }
      panel.style.display = 'block';
      btn.textContent = 'Hide visualization';
      btn.setAttribute('aria-expanded', 'true');
    }
  };

  toggleWrap.appendChild(btn);
}

function makeButton(label, cls, action) {
  const btn = document.createElement('button');
  btn.textContent = label;
  btn.className = cls;
  btn.onclick = action;
  return btn;
}

function goToNode(id) {
  const next = flowchart.find(n => n.id === id);
  historyStack.push(currentNode ? currentNode.id : '');
  currentNode = next;
  renderNode(currentNode);
}

function goBack() {
  const prevId = historyStack.pop();
  const prev = flowchart.find(n => n.id === prevId);
  currentNode = prev || currentNode;
  renderNode(currentNode);
}

function restart() {
  historyStack = [];
  currentSegment = "If You Should Act";
  currentNode = flowchart.find(n => n.id === "Q1");
  renderNode(currentNode);
}

// Start app
renderNode(currentNode);
</script>
</body>
</html>
